<!DOCTYPE html>
<html>
<head>
    <title>Chemical Structure Comparison</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
<header>
    <nav>
        <ul class="navigation-menu">
            <li><a href="/">Домой</a></li>
            <li><a href="/about">О модуле</a></li>
            <li><a href="#">Поиск соединения</a></li>
            <li><a href="#">Сравнение формул</a></li>
            <li><a href="/logout">Выйти</a></li>
        </ul>
    </nav>
</header>

<div class="page-content">
    <h1>Chemical Structure Comparison</h1>
    <form method="POST" class="comparison-form">
        {{ form.hidden_tag() }}
        <p>
            {{ form.patent_id.label }}<br>
            {{ form.patent_id(id="patent_id") }}<br>
            {% if form.patent_id.errors %}
                {% for error in form.patent_id.errors %}
                    <span style="color: red;">{{ error }}</span><br>
                {% endfor %}
            {% endif %}
        </p>

        <p>
            <label for="molfile_path">Выберите molfile:</label><br>
            <select name="molfile_path" id="molfile_path">
                <option value="">Выберите molfile</option>
            </select>
        </p>

        <p>
            <label for="second_patent_id">Выберите второй патент:</label><br>
            <select name="second_patent_id" id="second_patent_id">
                <option value="">Выберите патент</option>
            </select>
        </p>

        <p>
            <label for="chem_input2">Выберите SMILES для второго соединения:</label><br>
            <select name="chem_input2" id="chem_input2">
                <option value="">Выберите SMILES</option>
            </select>
        </p>
        <p>{{ form.submit() }}</p>
    </form>

    {% if similarity is not none %}
        <p>Tanimoto similarity: {{ similarity }}</p>
    {% endif %}
    {% if img1 %}
        <p>Molecule from molfile:</p>
        <img src="data:image/png;base64,{{ img1 }}" alt="Molecule 1 Image">
        {% if smiles_from_molfile %}
            <p>SMILES from molfile: {{ smiles_from_molfile }}</p>
        {% endif %}
    {% endif %}
    {% if img2 %}
        <p>Molecule from SMILES:</p>
        <img src="data:image/png;base64,{{ img2 }}" alt="Molecule 2 Image">
    {% endif %}
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var patentSelect = document.getElementById('patent_id');
        var molfileSelect = document.getElementById('molfile_path');
        var secondPatentSelect = document.getElementById('second_patent_id');
        var chemInput2Select = document.getElementById('chem_input2');

        patentSelect.addEventListener('change', function() {
            var selectedPatentId = patentSelect.value;

            fetch('/get_molfiles_for_patent/' + selectedPatentId)
                .then(response => response.json())
                .then(data => {
                    molfileSelect.innerHTML = '<option value="">Выберите molfile</option>'; // Clear previous entries

                    if (data.molfiles.length > 0) {
                        data.molfiles.forEach(function(molfile) {
                            var option = document.createElement('option');
                            option.value = molfile[0];
                            option.textContent = molfile[0];
                            molfileSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => console.error('Error fetching molfiles:', error));

            fetch('/get_patents_except/' + selectedPatentId)
                .then(response => response.json())
                .then(data => {
                    secondPatentSelect.innerHTML = '<option value="">Выберите патент</option>'; // Clear previous entries

                    if (data.patents.length > 0) {
                        data.patents.forEach(function(patent) {
                            var option = document.createElement('option');
                            option.value = patent[0];
                            option.textContent = patent[1];
                            secondPatentSelect.appendChild(option);
                        });
                    }
                })
                .catch(error => console.error('Error fetching patents:', error));
        });

        secondPatentSelect.addEventListener('change', function() {
            var selectedSecondPatentId = secondPatentSelect.value;

            fetch('/get_smiles_for_patent/' + selectedSecondPatentId)
                .then(response => response.json())
                .then(data => {
                    chemInput2Select.innerHTML = '<option value="">Выберите SMILES</option>'; // Clear previous entries

                    if (data.smiles.length > 0) {
                        data.smiles.forEach(function(smiles) {
                            var option = document.createElement('option');
                            option.value = smiles;
                            option.textContent = smiles;
                            chemInput2Select.appendChild(option);
                        });
                    }
                })
                .catch(error => console.error('Error fetching smiles:', error));
        });
    });
</script>
</body>
</html>
